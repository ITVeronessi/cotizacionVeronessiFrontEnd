<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Equipos</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 font-sans">

    <header class="bg-blue-600 text-white p-4 shadow-md">
        <h1 class="text-2xl font-bold">Gestión de Equipos</h1>
    </header>

    <main class="p-6">
        <!-- TABLA EQUIPOS -->
        <section class="bg-white p-4 rounded-lg shadow-md">
            <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-3">
                <h2 class="text-xl font-semibold">Equipos</h2>
                <div class="flex items-center gap-2 w-full md:w-auto">
                    <input id="searchInput" type="text" placeholder="Buscar equipo..."
                        class="border border-gray-300 rounded px-3 py-2 w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-blue-400">
                    <button id="btnAddEquipo" class="bg-blue-500 hover:bg-blue-700 text-white px-3 py-2 rounded">
                        Agregar
                    </button>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse" id="tableEquipos">
                    <thead>
                        <tr class="border-b bg-gray-100">
                            <th class="py-2 px-3">Nombre</th>
                            <th class="py-2 px-3">Precio</th>
                            <th class="py-2 px-3 text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- MODAL -->
    <div id="modalForm" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg w-full max-w-lg p-6 relative">
            <h2 id="modalTitle" class="text-xl font-bold mb-4"></h2>
            <form id="formModal" class="space-y-4"></form>
            <div class="flex justify-end mt-4">
                <button id="btnCloseModal"
                    class="bg-gray-500 hover:bg-gray-700 text-white px-4 py-2 rounded mr-2">Cancelar</button>
                <button id="btnSaveModal"
                    class="bg-blue-500 hover:bg-blue-700 text-white px-4 py-2 rounded">Guardar</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000'; // ajusta tu API
        const modal = document.getElementById('modalForm');
        const modalTitle = document.getElementById('modalTitle');
        const formModal = document.getElementById('formModal');
        const searchInput = document.getElementById('searchInput');
        document.getElementById('btnCloseModal').onclick = () => modal.classList.add('hidden');

        let equipos = []; // se almacenan todos los equipos cargados
        let currentId = null;

        // ---------------- MODAL ----------------
        function openModal(title, data = {}) {
            currentId = data.idequipo || null;
            modalTitle.innerText = title;
            formModal.innerHTML = `
        <div>
            <label class="block font-semibold mb-1">Nombre</label>
            <input type="text" name="nombreequipo" value="${data.nombreequipo || ''}" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
        </div>
        <div>
            <label class="block font-semibold mb-1">Precio</label>
            <input type="number" name="precio" value="${data.precio || ''}" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
        </div>
    `;
            modal.classList.remove('hidden');
        }

        // ---------------- GUARDAR ----------------
        document.getElementById('btnSaveModal').onclick = async () => {
            const formData = {};
            formModal.querySelectorAll('input').forEach(i => formData[i.name] = i.value);

            const url = currentId ? `${API_URL}/equipos/${currentId}` : `${API_URL}/equipos`;
            const method = currentId ? 'PUT' : 'POST';

            await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });

            modal.classList.add('hidden');
            loadEquipos();
        };

        // ---------------- CARGAR EQUIPOS ----------------
        async function loadEquipos() {
            const res = await fetch(`${API_URL}/equipos/`);
            equipos = await res.json();
            renderEquipos(equipos);
        }

        // ---------------- RENDERIZAR EQUIPOS ----------------
        function renderEquipos(lista) {
            const tbody = document.querySelector('#tableEquipos tbody');
            tbody.innerHTML = '';

            if (lista.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" class="text-center py-4 text-gray-500">No se encontraron equipos</td></tr>`;
                return;
            }

            lista.forEach(e => {
                tbody.innerHTML += `
        <tr class="border-b hover:bg-gray-50 transition">
            <td class="py-2 px-3">${e.nombreequipo}</td>
            <td class="py-2 px-3">$${e.precio}</td>
            <td class="py-2 px-3 text-center">
                <button onclick="editEquipo(${e.idequipo})" class="bg-green-500 hover:bg-green-700 text-white px-2 py-1 rounded mr-2">Editar</button>
                <button onclick="deleteEquipo(${e.idequipo})" class="bg-red-500 hover:bg-red-700 text-white px-2 py-1 rounded">Eliminar</button>
            </td>
        </tr>`;
            });
        }

        // ---------------- FILTRAR EQUIPOS ----------------
        searchInput.addEventListener('input', e => {
            const term = e.target.value.toLowerCase();
            const filtrados = equipos.filter(eq =>
                eq.nombreequipo.toLowerCase().includes(term)
            );
            renderEquipos(filtrados);
        });

        // ---------------- EDITAR ----------------
        async function editEquipo(id) {
            const res = await fetch(`${API_URL}/equipos/${id}`);
            const data = await res.json();
            openModal('Modificar Equipo', data);
        }

        // ---------------- ELIMINAR ----------------
        async function deleteEquipo(id) {
            if (confirm('¿Seguro que deseas eliminar este equipo?')) {
                await fetch(`${API_URL}/equipos/${id}`, { method: 'DELETE' });
                loadEquipos();
            }
        }

        // ---------------- AGREGAR ----------------
        document.getElementById('btnAddEquipo').onclick = () => openModal('Agregar Equipo');

        // ---------------- INICIALIZAR ----------------
        loadEquipos();
    </script>

</body>

</html>